<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sky: Children of the Light Daily Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Outfit:wght@400;600&display=swap');
        
        :root {
            --bg-color: #121418;
            --card-bg: #1e2229;
            --primary: #5c9aff;
            --accent: #ffcc00;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --border: #2a2f3a;
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .quest-list .quest-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 1.1em;
        }
        .quest-list .quest-item:last-child { border-bottom: none; }
        .quest-item .num { 
            color: var(--accent); 
            font-weight: bold; 
            margin-right: 10px;
        }
        
        .highlight-row { 
            background: rgba(255, 255, 255, 0.05); 
            padding: 5px 10px;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .rewards-text { color: #ffd700; }

        h1, h2, h3 { margin: 0; }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid var(--border);
        }
        
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .timestamp { color: var(--text-sub); font-size: 0.9rem; }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            max_width: 1600px;
            margin: 0 auto;
            align-items: start;
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }
        
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }

        .card-header {
            padding: 15px 20px;
            background: rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        
        .card-header h2 { font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 12px; background: var(--primary); color: #fff; }
        .badge.Red { background: #ff4757; }
        .badge.Black { background: #2f3542; }
        .subtitle { font-size: 0.9rem; color: var(--accent); }

        .card-body { padding: 20px; flex: 1; }
        .scrollable { max-height: 800px; overflow-y: auto; }

        /* Shards */
        .info-row { margin-bottom: 8px; }
        .tags { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
        .tag { background: #333; padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; color: #ccc; }
        .shard-img { width: 100%; border-radius: 8px; margin-top: 15px; cursor: pointer; transition: opacity 0.2s; }
        .shard-img:hover { opacity: 0.9; }
        .shard-status-dynamic { font-weight: bold; color: var(--accent); }

        /* Candles */
        .pair-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .pair-item { padding: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); }
        .desc { margin-bottom: 10px; line-height: 1.5; font-size: 0.95rem; }
        .num { color: var(--accent); font-weight: bold; margin-right: 5px; }
        .pair-item img { width: 100%; border-radius: 8px; cursor: pointer; aspect-ratio: 16/9; object-fit: cover; }
        
        .desc-list { margin-bottom: 20px; }
        .img-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .img-grid img { width: 100%; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
        .img-grid img:hover { transform: scale(1.02); }

        /* Clock */
        .event-row {
            background: rgba(255,255,255,0.05);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-rows: auto auto auto;
            gap: 5px;
        }
        .event-name { font-weight: bold; font-size: 1.1rem; grid-column: 1 / -1; }
        .event-time { color: var(--text-sub); }
        .event-countdown { color: var(--primary); font-family: monospace; font-size: 1.2rem; font-weight: bold; text-align: right; }
        .event-status { grid-column: 1 / -1; margin-top: 5px; text-align: center; background: #2a2f3a; }
        .event-status.active { background: #2ed573; color: #fff; }
        .event-status.waiting { background: #ffa502; color: #fff; }

        /* Modal */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center;
        }
        .modal img { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .close { position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Sky: Children of the Light</h1>
        <div class="timestamp">更新時間 (Updated)：2026-01-25 08:33:47</div>
    </div>

    <div class="grid-container">
        <!-- Column 1: Quests & Shards (Swapped) -->
        <div class="column-wrapper" style="display:flex; flex-direction:column; gap:20px;">
            
        <div class="card">
            <div class="card-header">
                <h2>每日任務 (Quests)</h2>
            </div>
            <div class="card-body">
                <div class="quest-list"><div class="quest-item"><span class="num">1</span> 城塞都市在彷徨う抓住之光</div><div class="quest-item"><span class="num">2</span> 城塞都市的高所在冥想</div><div class="quest-item"><span class="num">3</span> 收集 30 滴燭火</div><div class="quest-item"><span class="num">4</span> 重溫一位霞谷先靈的記憶</div></div>
            </div>
        </div>
        
            
        <div class="card">
            <div class="card-header">
                <h2>每日碎石 (Shards)</h2>
                <div class="row-center">
                     <span class="badge 紅石 (Red)">紅石 (Red)</span>
                </div>
            </div>
            <div class="card-body">
                <div class="info-row highlight-row"><strong>日期：</strong> 2026年1月25日 星期日</div>
                <div class="info-row"><strong>地圖：</strong> 禁閣 的 星漠沙灘</div>
                <div class="info-row"><strong>獎勵：</strong> <span class="rewards-text">獎勵可達 3.5 支昇華蠟燭</span></div>
                <div class="info-row"><strong>時間：</strong> 上午05:48:40 - 上午09:40:00</div>
                <div class="info-row"><strong>狀態：</strong> 進行中! 距離結束: 1小時 6分 16秒</div>
                <div class="eruptions-list">
                    <strong>爆發時間 (24H)：</strong>
                    <div class="tags"><span class="tag">下午11:48:40 - 上午03:40:00</span><span class="tag">上午05:48:40 - 上午09:40:00</span><span class="tag">上午11:48:40 - 下午03:40:00</span></div>
                </div>
                <img src="https://sky-shards.pages.dev/infographics/memory_clement/3.webp" onclick="openModal(this.src)" class="shard-img">
            </div>
        </div>
        
        </div>
        
        <!-- Column 2: Treasures -->
        
        <div class="card">
            <div class="card-header">
                <h2>大蠟燭 (Treasure)</h2>
                <span class="subtitle">Valley of Triumph | Rotation 1</span>
            </div>
            <div class="card-body scrollable">
                <div class="pair-grid">
                <div class="pair-item">
                    <div class="desc"><span class="num">1</span> 社交空間/大廳：位於區域左側，靠近衣櫃旁邊。</div>
                    <img src="images/treasure_1.png" onclick="openModal(this.src)">
                </div>
                
                <div class="pair-item">
                    <div class="desc"><span class="num">2</span> 溜冰場：位於區域中央，通往霞光城橋樑上。</div>
                    <img src="images/treasure_2.png" onclick="openModal(this.src)">
                </div>
                
                <div class="pair-item">
                    <div class="desc"><span class="num">3</span> 霞光城/城堡：通過第一個拱門後，位於第二個平臺上。</div>
                    <img src="images/treasure_3.png" onclick="openModal(this.src)">
                </div>
                
                <div class="pair-item">
                    <div class="desc"><span class="num">4</span> 競技場/體育館：位於左側邊緣，看臺底部。</div>
                    <img src="images/treasure_4.png" onclick="openModal(this.src)">
                </div>
                </div>
            </div>
        </div>
        
        
        <!-- Column 3: Seasonal & Clock -->
        <div class="column-wrapper" style="display:flex; flex-direction:column; gap:20px;">
            
        <div class="card">
            <div class="card-header">
                <h2>季節蠟燭 (Seasonal)</h2>
                <span class="subtitle">Unknown | Rotation 1</span>
            </div>
            <div class="card-body scrollable">
                <div class="desc-list"></div><div class="img-grid"></div>
            </div>
        </div>
        
            
        <div class="card">
            <div class="card-header">
                <h2>每日事件時鐘 (Events)</h2>
            </div>
            <div class="card-body">
                
            <div class="event-row" id="event-geyser" data-seconds="5479">
                <div class="event-name">噴泉 (Geyser)</div>
                <div class="event-time">下次: 10:05</div>
                <div class="event-countdown">--:--:--</div>
                <div class="event-status tag waiting">計算中...</div>
            </div>
            
                
            <div class="event-row" id="event-grandma" data-seconds="79">
                <div class="event-name">奶奶 (Grandma)</div>
                <div class="event-time">下次: 08:35</div>
                <div class="event-countdown">--:--:--</div>
                <div class="event-status tag waiting">計算中...</div>
            </div>
            
                
            <div class="event-row" id="event-turtle" data-seconds="979">
                <div class="event-name">海龜 (Turtle)</div>
                <div class="event-time">下次: 08:50</div>
                <div class="event-countdown">--:--:--</div>
                <div class="event-status tag waiting">計算中...</div>
            </div>
            
            </div>
        </div>
        
        </div>
    </div>

    <!-- Modal -->
    <div id="imgModal" class="modal" onclick="this.style.display='none'">
        <span class="close">&times;</span>
        <img id="modalImg">
    </div>

    <script>
        // Data injected from Python
        const SHARD_TIMES = ["23:48-03:40", "05:48-09:40", "11:48-15:40"];

        // Modal
        function openModal(src) {
            document.getElementById('imgModal').style.display = "flex";
            document.getElementById('modalImg').src = src;
        }

        // --- SHARD LOGIC ---
        function updateShardStatus() {
            const rows = document.querySelectorAll('.card-body .info-row');
            let statusRow = null;
            rows.forEach(r => {
                if (r.textContent.includes("狀態：")) statusRow = r;
            });

            if (!statusRow || SHARD_TIMES.length === 0) return;

            const now = new Date();
            let msg = "今日所有爆發已結束";
            
            // 1. Parse all times into objects
            // We'll create simple objects: { start: Date, end: Date, str: "HH:MM-HH:MM" }
            const events = SHARD_TIMES.map(range => {
                const parts = range.split('-');
                if (parts.length < 2) return null;
                
                const [h1, m1] = parts[0].trim().split(':').map(Number);
                const [h2, m2] = parts[1].trim().split(':').map(Number);
                
                const s = new Date(now); s.setHours(h1, m1, 0, 0);
                const e = new Date(now); e.setHours(h2, m2, 0, 0);
                
                // Handle overnight crossing (e.g. 23:00 - 01:00)
                if (e < s) e.setDate(e.getDate() + 1);
                
                return { start: s, end: e };
            }).filter(e => e !== null);
            
            // 2. Sort by Start Time
            events.sort((a, b) => a.start - b.start);
            
            // 3. Find Active or Next
            let targetEvent = null;
            let type = "none"; // active, waiting
            
            for (let ev of events) {
                if (now >= ev.start && now < ev.end) {
                    targetEvent = ev;
                    type = "active";
                    break;
                }
                if (now < ev.start) {
                    targetEvent = ev;
                    type = "waiting";
                    break;
                }
            }
            
            // 4. If nothing found (all passed today), loop to First event of Tomorrow
            if (!targetEvent && events.length > 0) {
                targetEvent = { ...events[0] }; // Clone
                targetEvent.start.setDate(targetEvent.start.getDate() + 1);
                targetEvent.end.setDate(targetEvent.end.getDate() + 1);
                type = "waiting";
            }

            // 5. Generate Message
            if (targetEvent) {
                if (type === "active") {
                    const diff = (targetEvent.end - now) / 1000;
                    const dM = Math.floor(diff / 60);
                    const dS = Math.floor(diff % 60);
                    msg = `進行中! (距離結束: ${dM}分 ${dS}秒)`;
                } else if (type === "waiting") {
                     const diff = (targetEvent.start - now) / 1000;
                     const dH = Math.floor(diff / 3600);
                     const dM = Math.floor((diff % 3600) / 60);
                     const dS = Math.floor(diff % 60);
                     
                     // Helper: Check if it's tomorrow
                     const isTom = targetEvent.start.getDate() !== now.getDate();
                     const prefix = isTom ? "等待中 (明天):" : "等待中:";
                     msg = `${prefix} ${dH}小時 ${dM}分 ${dS}秒`;
                }
            }

            statusRow.innerHTML = `<strong>狀態：</strong> <span class="shard-status-dynamic">${msg}</span>`;
        }


        // --- CLOCK LOGIC ---
        function isDST(date) {
            const year = date.getFullYear();
            let march = new Date(year, 2, 1); // March 1
            while (march.getDay() !== 0) march.setDate(march.getDate() + 1);
            const dstStart = new Date(year, 2, march.getDate() + 7); // 2nd Sunday

            // DST Ends 1st Sunday in Nov
            let nov = new Date(year, 10, 1); // Nov 1
            while (nov.getDay() !== 0) nov.setDate(nov.getDate() + 1);
            const dstEnd = nov; // 1st Sunday

            // Reset time to midnight for comparison
            const today = new Date(date).setHours(0,0,0,0);
            return today >= dstStart.setHours(0,0,0,0) && today < dstEnd.setHours(0,0,0,0);
        }

        const EVENTS = {
            'geyser': { min: 5, duration: 10 },
            'grandma': { min: 35, duration: 10 },
            'turtle': { min: 50, duration: 10 }
        };

        function updateClock() {
            const now = new Date();
            const dst = isDST(now);
            const startOffset = dst ? 1 : 0; // Summer: Odd (1,3..), Winter: Even (0,2..)

            for (const [key, info] of Object.entries(EVENTS)) {
                const row = document.getElementById('event-'+key);
                if (!row) continue;

                // Find next/current event
                let foundNext = null;
                let isActive = false;
                let remainingActive = 0;

                // Check upcoming 24 hours
                for (let i = 0; i < 24; i++) {
                    let target = new Date(now);
                    target.setHours(now.getHours() + i);
                    target.setMinutes(info.min);
                    target.setSeconds(0);
                    
                    // Check if target hour matches cycle
                    if ((target.getHours() % 2) !== startOffset) continue;

                    // If target is in the past, it might be ACTIVE
                    // Active range: target <= now < target + 10m
                    const endTime = new Date(target.getTime() + info.duration * 60000);
                    
                    if (now >= target && now < endTime) {
                        isActive = true;
                        remainingActive = (endTime - now) / 1000; // seconds
                        foundNext = target; // It's this one
                        break;
                    }

                    // If target is in future
                    if (target > now) {
                        foundNext = target;
                        break;
                    }
                }

                if (foundNext) {
                    const statusDiv = row.querySelector('.event-status');
                    const cdDiv = row.querySelector('.event-countdown');
                    const timeDiv = row.querySelector('.event-time');

                    // Format Next Time
                    const hStr = foundNext.getHours().toString().padStart(2, '0');
                    const mStr = foundNext.getMinutes().toString().padStart(2, '0');
                    timeDiv.textContent = `下次: ${hStr}:${mStr}`;

                    if (isActive) {
                        const rMin = Math.floor(remainingActive / 60);
                        const rSec = Math.floor(remainingActive % 60);
                        statusDiv.textContent = `進行中 (剩餘 ${rMin}分 ${rSec}秒)`;
                        statusDiv.className = "event-status tag active";
                        cdDiv.textContent = ""; 
                    } else {
                        // Countdown
                        const diff = (foundNext - now) / 1000;
                        const dH = Math.floor(diff / 3600);
                        const dM = Math.floor((diff % 3600) / 60);
                        const dS = Math.floor(diff % 60);
                        
                        statusDiv.textContent = "等待中";
                        statusDiv.className = "event-status tag waiting";
                        cdDiv.textContent = `${dH}小時 ${dM}分 ${dS}秒`;
                    }
                }
            }
        }

        function loop() {
            updateClock();
            updateShardStatus();
        }

        setInterval(loop, 1000);
        loop(); // Init
    </script>
</body>
</html>
    